<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin — HijabbyVla</title>
<style>
  :root{--accent:#e11d48;--muted:#666}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:#fafafa;color:#111}
  header{background:#fff;padding:14px 20px;border-bottom:1px solid #eee}
  .container{max-width:1100px;margin:24px auto;padding:0 16px}
  .tabs{display:flex;gap:8px}
  .tab{padding:8px 12px;border-radius:10px;background:#fff;cursor:pointer;border:1px solid #eee}
  .tab.active{box-shadow:0 2px 10px rgba(0,0,0,0.06);border-color:var(--accent);color:var(--accent)}
  .card{background:#fff;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(12,12,12,0.04);margin-top:16px}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:8px;border-bottom:1px solid #f0f0f0;text-align:left}
  img.thumb{height:48px;border-radius:8px;object-fit:cover}
  input,select,textarea{padding:8px;border:1px solid #ddd;border-radius:8px;width:100%}
  .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
  .btn.ghost{background:#fff;color:var(--accent);border:1px solid #eee}
  .small{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
<header>
  <div class="container">
    <div style="display:flex;align-items:center;justify-content:space-between">
      <div style="font-weight:700">Admin Panel — hijabbyvla</div>
      <div class="small">Terhubung: <span id="apiBase">/api</span></div>
    </div>
  </div>
</header>

<main class="container">
  <div class="tabs">
    <div class="tab active" data-tab="products">Produk</div>
    <div class="tab" data-tab="orders">Pesanan</div>
    <div class="tab" data-tab="promos">Promo</div>
  </div>

  <!-- PRODUCTS -->
  <div id="products" class="card">
    <h3>Kelola Produk</h3>
    <form id="productForm" style="display:grid;grid-template-columns:1fr 320px;gap:12px;margin-top:12px">
      <div style="display:grid;gap:8px">
        <input name="id" type="hidden">
        <input name="name" placeholder="Nama produk" required>
        <div style="display:flex;gap:8px"><input name="motif" placeholder="Motif"><input name="size" placeholder="Ukuran"></div>
        <div style="display:flex;gap:8px"><input name="price" placeholder="Harga (angka)" type="number"><input name="stock" placeholder="Stok" type="number"></div>
        <input name="rating" placeholder="Rating (ex: 4.5)" type="number" step="0.1">
        <textarea name="description" placeholder="Deskripsi"></textarea>
        <div style="display:flex;gap:8px"><button class="btn" type="submit">Simpan</button><button id="resetProduct" type="button" class="btn ghost">Bersihkan</button></div>
      </div>
      <div>
        <div style="font-size:13px;margin-bottom:8px">Gambar produk</div>
        <img id="preview" src="" style="width:100%;height:200px;object-fit:cover;border-radius:8px;border:1px dashed #eee;display:none">
        <input id="imageInput" name="image" type="file" accept="image/*">
      </div>
    </form>

    <div id="productsList" style="margin-top:16px"></div>
  </div>

  <!-- ORDERS -->
  <div id="orders" class="card" style="display:none">
    <h3>Pesanan</h3>
    <div id="ordersList"></div>
  </div>

  <!-- PROMOS -->
  <div id="promos" class="card" style="display:none">
    <h3>Promo</h3>
    <form id="promoForm" style="display:grid;grid-template-columns:1fr 200px;gap:12px;margin-top:12px">
      <div style="display:grid;gap:8px">
        <input name="id" type="hidden">
        <input name="code" placeholder="Kode promo (unik)" required>
        <input name="description" placeholder="Deskripsi singkat">
        <div style="display:flex;gap:8px">
          <select name="discount_type"><option value="percent">Persen</option><option value="fixed">Nominal</option></select>
          <input name="discount_value" placeholder="Nilai diskon" type="number">
        </div>
        <div style="display:flex;gap:8px"><input name="start_date" placeholder="Mulai (YYYY-MM-DD)"><input name="end_date" placeholder="Akhir (YYYY-MM-DD)"></div>
        <div style="display:flex;gap:8px"><label><input type="checkbox" name="active" checked> Aktif</label></div>
        <div><button class="btn" type="submit">Simpan Promo</button><button id="resetPromo" type="button" class="btn ghost">Bersihkan</button></div>
      </div>
      <div>
        <div id="promosList" style="margin-top:0"></div>
      </div>
    </form>
  </div>

</main>

<script>
const API = '../api';
// tabs
document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>{
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  const name = t.dataset.tab;
  ['products','orders','promos'].forEach(id=> document.getElementById(id).style.display = id===name? 'block':'none');
}));

// PRODUCTS
const productForm = document.getElementById('productForm');
const productsList = document.getElementById('productsList');
const preview = document.getElementById('preview');
const imageInput = document.getElementById('imageInput');

function fetchProducts(){
  fetch(API + '/products.php').then(r=>r.json()).then(data=>{
    renderProducts(data);
  });
}

function renderProducts(items){
  if (!items || !items.length) { productsList.innerHTML = '<div class="small">Belum ada produk</div>'; return; }
  let html = `<table><thead><tr><th>#</th><th>Produk</th><th>Harga</th><th>Stok</th><th>Aksi</th></tr></thead><tbody>`;
  items.forEach(p=>{
    html += `<tr><td>${p.id}</td><td><div style="display:flex;gap:8px;align-items:center"><img class='thumb' src='${p.image||"../uploads/placeholder.png"}'/><div><div style='font-weight:600'>${p.name}</div><div class='small'>${p.motif || ''} · ${p.size || ''}</div></div></div></td><td>${p.price}</td><td>${p.stock}</td><td><button onclick='editProduct(${p.id})' class='btn ghost'>Edit</button> <button onclick='deleteProduct(${p.id})' class='btn' style='background:#ef4444'>Hapus</button></td></tr>`;
  });
  html += '</tbody></table>';
  productsList.innerHTML = html;
}

productForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const form = new FormData(productForm);
  const id = form.get('id');
  if (imageInput.files.length) form.set('image', imageInput.files[0]);
  const res = await fetch(API + '/products.php', { method: 'POST', body: form });
  const j = await res.json();
  alert('Produk tersimpan');
  productForm.reset(); preview.style.display='none'; imageInput.value='';
  fetchProducts();
});

imageInput.addEventListener('change', ()=>{
  const f = imageInput.files[0];
  if (!f) return; const url = URL.createObjectURL(f); preview.src = url; preview.style.display='block';
});

window.editProduct = async function(id){
  const res = await fetch(API + '/products.php?id=' + id);
  const p = await res.json();
  productForm.name.value = p.name || '';
  productForm.motif.value = p.motif || '';
  productForm.size.value = p.size || '';
  productForm.price.value = p.price || 0;
  productForm.stock.value = p.stock || 0;
  productForm.rating.value = p.rating || '';
  productForm.description.value = p.description || '';
  productForm.id.value = p.id;
  if (p.image) { preview.src = '../' + p.image; preview.style.display='block'; }
}

window.deleteProduct = async function(id){
  if (!confirm('Hapus produk #' + id + '?')) return;
  const res = await fetch(API + '/products.php', { method: 'DELETE', body: 'id='+id });
  const j = await res.json(); fetchProducts();
}

// ORDERS
async function fetchOrders(){
  const res = await fetch(API + '/orders.php');
  const list = await res.json();
  const el = document.getElementById('ordersList');
  if (!list.length) { el.innerHTML = '<div class="small">Belum ada pesanan</div>'; return; }
  let html = '<table><thead><tr><th>#</th><th>Pelanggan</th><th>Total</th><th>Status</th><th>Aksi</th></tr></thead><tbody>';
  list.forEach(o=>{
    html += `<tr><td>${o.id}</td><td>${o.customer_name}<div class='small'>${o.phone}</div></td><td>${o.total}</td><td>${o.status}</td><td><button onclick="updateStatus(${o.id}, 'shipped')" class='btn ghost'>Kirim</button></td></tr>`;
  });
  html += '</tbody></table>';
  el.innerHTML = html;
}

window.updateStatus = async function(id, status){
  await fetch(API + '/orders.php', { method:'PUT', body: 'id='+id+'&status='+status });
  fetchOrders();
}

// PROMOS
const promoForm = document.getElementById('promoForm');
const promosList = document.getElementById('promosList');
async function fetchPromos(){
  const res = await fetch(API + '/promos.php');
  const list = await res.json();
  if (!list.length) { promosList.innerHTML = '<div class="small">Belum ada promo</div>'; return; }
  let html = '<table><thead><tr><th>#</th><th>Kode</th><th>Diskon</th><th>Aktif</th><th>Aksi</th></tr></thead><tbody>';
  list.forEach(p=>{
    html += `<tr><td>${p.id}</td><td>${p.code}</td><td>${p.discount_type==='percent'?p.discount_value+'%':p.discount_value}</td><td>${p.active? 'Ya':'Tidak'}</td><td><button onclick="editPromo(${p.id})" class='btn ghost'>Edit</button> <button onclick="deletePromo(${p.id})" class='btn' style='background:#ef4444'>Hapus</button></td></tr>`;
  });
  html += '</tbody></table>';
  promosList.innerHTML = html;
}

promoForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = new FormData(promoForm);
  const obj = {};
  for (const [k,v] of f.entries()) obj[k]=v;
  obj.active = promoForm.querySelector('[name=active]').checked?1:0;
  const res = await fetch(API + '/promos.php', { method:'POST', body: JSON.stringify(obj) });
  const j = await res.json();
  alert('Promo disimpan'); promoForm.reset(); fetchPromos();
});

window.editPromo = async function(id){
  const r = await fetch(API + '/promos.php?id=' + id); const p = await r.json();
  promoForm.code.value = p.code; promoForm.description.value = p.description; promoForm.discount_value.value = p.discount_value; promoForm.discount_type.value = p.discount_type; promoForm.start_date.value = p.start_date; promoForm.end_date.value = p.end_date; promoForm.active.checked = p.active==1; promoForm.id.value = p.id;
}
window.deletePromo = async function(id){ if (!confirm('Hapus promo?')) return; await fetch(API + '/promos.php', { method:'DELETE', body: 'id='+id }); fetchPromos(); }

// init
fetchProducts(); fetchOrders(); fetchPromos();
</script>
</body>
</html>
